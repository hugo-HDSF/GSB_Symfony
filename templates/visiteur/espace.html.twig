{% extends 'base.html.twig' %}

{% block title %}GSB Espace Visiteur{% endblock %}

{% block body %}
    <div class="container">
        <div class="columns is-10 is-centered is-multiline">
            <div class="column is-12">
                <div class="box is-transparent has-no-padding animate__animated animate__fadeInDown">
                    <div class="columns is-mobile">
                        <div id="menupastyear" class="column">
                            <i id="arrowpastyear" class="fas fa-chevron-left fa-lg grow cursor-pointer"></i>
                            <strong>{{year-1}}</strong>
                        </div>
                        <div class="column is-9-desktop is-8-tablet is-6-mobile">
                            <p id="pastyear" class="is-hidden"><strong>{{year-1}}</strong></p>
                            <p id="currentyear"><strong>{{year}}</strong></p>
                        </div>
                        <div id="menunextyear" class="column is-invisible">
                            <strong>{{year}}</strong>
                            <i id="arrownextyear" class="fas fa-chevron-right fa-lg grow cursor-pointer"></i>
                        </div>
                    </div>
                    <script>
                        $(document).ready(function() {
                            $('i[id*="arrowpastyear"]').click(function () {
                                $("#columncurrent,#currentyear").fadeOut(150, function () {
                                    $("#columncurrent,#currentyear").hide();
                                    $("#menupastyear").fadeTo(500, 0, function(){
                                        $("#menupastyear").addClass('is-invisible')
                                    })
                                    $("#columnpast,#pastyear").removeClass('is-hidden').show();
                                    $("#menunextyear").fadeTo(500, 100, function(){
                                        $("#menunextyear").removeClass('is-invisible');
                                    })
                                })
                            });
                        });
                    </script>
                    <script>
                        $(document).ready(function() {
                            $('i[id*="arrownextyear"]').click(function () {
                                $("#columnpast,#pastyear").fadeOut(150, function () {
                                    $("#columnpast,#pastyear").hide();
                                    $("#menunextyear").fadeTo(500, 0, function(){
                                        $("#menunextyear").addClass('is-invisible')
                                    })
                                    $("#columncurrent,#currentyear").show();
                                    $("#menupastyear").fadeTo(500, 100, function(){
                                        $("#menupastyear").removeClass('is-invisible');
                                    })
                                });
                            });
                        });
                    </script>
                </div>
                {% for flashMessage in app.session.flashbag.get('connexionSTATE') %}
                    {% if flashMessage == 'connexionSUCCESS' %}
                        <div class="notification is-small is-success has-border-radius-40 animate__animated animate__fadeInDown">
                            <button class="delete is-centered"></button>
                            <div class="content is-small">
                                <strong>Bonjour {{ session.get('prenom') }} {{ session.get('nom') }}; <strong>Connecté</strong> avec <strong>succés</strong>.</strong>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
                {% for flashMessage in app.session.flashbag.get('setfraisforfaitSTATE') %}
                    {% if flashMessage == 'setfraisforfaitSUCCESS' %}
                        <div class="notification is-small is-success has-border-radius-40 animate__animated animate__fadeInDown">
                            <button class="delete is-centered"></button>
                            <div class="content is-small">
                                <strong>Frais forfait mis à jour; </strong><strong>Fiche de frais MODIFIÉE</strong> avec <strong>SUCCÉS.</strong>
                            </div>
                        </div>
                    {% elseif flashMessage == 'setfraisforfaitERROR' %}
                        <div class="notification is-small is-danger has-border-radius-40 animate__animated animate__fadeInDown">
                            <button class="delete is-centered"></button>
                            <div class="content is-small">
                                <strong>Fiche de frais INEXISTANTE</strong> ou <strong>NON MODIFIABLE.</strong>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
                {% for flashMessage in app.session.flashbag.get('addfichefraisSTATE') %}
                    {% if flashMessage == 'addfichefraisSUCCESS' %}
                        <div class="notification is-small is-success has-border-radius-40 animate__animated animate__fadeInDown">
                            <button class="delete is-centered"></button>
                            <div class="content is-small">
                                <strong>Fiche de frais AJOUTÉE</strong> avec <strong>SUCCÉS.</strong>
                            </div>
                        </div>
                    {% elseif flashMessage == 'addfichefraisERROR' %}
                        <div class="notification is-small is-danger has-border-radius-40 animate__animated animate__fadeInDown">
                            <button class="delete is-centered"></button>
                            <div class="content is-small">
                                <strong>AJOUT</strong> de la fiche de frais<strong> IMPOSSIBLE </strong>, veuillez rentrer des données <strong>CONFORMES.</strong>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
                {% for flashMessage in app.session.flashbag.get('setfraishorsforfaitSTATE') %}
                    {% if flashMessage == 'setfraishorsforfaitSUCCESS' %}
                        <div class="notification is-small is-success has-border-radius-40 animate__animated animate__fadeInDown">
                            <button class="delete is-centered"></button>
                            <div class="content is-small">
                                <strong>Frais hors forfait mis à jour; </strong><strong>Fiche de frais MODIFIÉE</strong> avec <strong>SUCCÉS.</strong>
                            </div>
                        </div>
                    {% elseif flashMessage == 'setfraisforfaitERROR' %}
                        <div class="notification is-small is-danger has-border-radius-40 animate__animated animate__fadeInDown">
                            <button class="delete is-centered"></button>
                            <div class="content is-small">
                                <strong>Fiche de frais INEXISTANTE</strong> ou <strong>NON MODIFIABLE.</strong> Si vous souhaitez ajouter des frais hors forfait, veuillez les reporter à la fiche de frais du mois courant.
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
                {% for flashMessage in app.session.flashbag.get('removefichefraisSTATE') %}
                    {% if flashMessage == 'removefichefraisSUCCESS' %}
                        <div class="notification is-small is-success has-border-radius-40 animate__animated animate__fadeInDown">
                            <button class="delete is-centered"></button>
                            <div class="content is-small">
                                <strong>Fiche de frais SUPPRIMÉE</strong> avec <strong>SUCCÉS.</strong>
                            </div>
                        </div>
                    {% elseif flashMessage == 'removefichefraisERROR' %}
                        <div class="notification is-small is-danger has-border-radius-40 animate__animated animate__fadeInDown">
                            <button class="delete is-centered"></button>
                            <div class="content is-small">
                                <strong>Fiche de frais INEXISTANTE</strong> ou <strong>IMPOSSIBLE à SUPPRIMER.</strong>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        <div id="columncurrent" class="columns is-10 is-centered is-multiline">
            <div class="column is-12">
                <div class="columns is-multiline">
                    {% if ajouterfichefrais %}
                    <div id="divadd" class="column is-3-desktop is-6-tablet is-12-mobile">
                        <div id="boxadd" class="box grow-smaller is-transparent is-like-une-fiche-frais animate__animated animate__fadeIn">
                            <div class="column has-background-transparent">
                                <div class="columns is is-multiline">
                                    <div class="column">
                                        <div class="column is-12 has-no-padding-bottom">
                                            <strong>Ajouter une nouvelle</strong>
                                        </div>
                                        <div class="column is-12 has-2px-padding-top">
                                            <strong>fiche de frais</strong>
                                        </div>
                                        <div class="column is-12">
                                            <span class="icon is-insane is-left">
                                                <i class="fas fa-plus fa-7x"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <script>
                        $(document).ready(function() {
                            $("#boxadd").click(function () {
                                $("#divadd").fadeOut(150, function () {
                                    $("#divadd").hide();

                                    $("#divac0").removeClass('is-hidden').show();
                                })
                            });
                        });
                    </script>
                    <script>
                        $(document).ready(function() {
                            $('i[id*="arrownextyear"]').click(function () {
                                $("#columnpast,#pastyear").fadeOut(150, function () {
                                    $("#columnpast,#pastyear").hide();
                                    $("#menunextyear").fadeTo(500, 0, function(){
                                        $("#menunextyear").addClass('is-invisible')
                                    })
                                    $("#columncurrent,#currentyear").show();
                                    $("#menupastyear").fadeTo(500, 100, function(){
                                        $("#menupastyear").removeClass('is-invisible');
                                    })
                                });
                            });
                        });
                    </script>
                    <div id="divac0" class="column is-3-desktop is-6-tablet is-12-mobile is-hidden">
                        <div id="boxac0" class="box is-transparent is-like-une-fiche-frais animate__animated animate__fadeIn">
                            <div class="column has-background-transparent">
                                <div class="is-relative">
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px is-month-bar has-background-success">
                                            <span class="icon">
                                                <i class="fas fa-file-invoice"></i>
                                            </span>
                                            <span>
                                                <strong>{{yearmonth | format_datetime(pattern="MMMM", locale="fr") | upper}} {{ year }}</strong>
                                            </span>
                                            <span class="icon">
                                                <i class="fas fa-lock-open"></i>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="columns is-flex-mobile">
                                        <div class="column has-finest-padding-1024px">
                                            <button id="modifyac0" class="button is-fullwidth is-small is-success has-border-radius-40">
                                                <span class="icon">
                                                    <i class="fas fa-edit"></i>
                                                </span>
                                                <span>EN COURS</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger has-no-border-radius-top-left is-a-bit-transparent">
                                                    <span class="icon">
                                                        <i class="fas fa-calendar-alt"></i>
                                                    </span>
                                                    <span>Période</span>
                                                </span>
                                                <span class="tag has-text-bigger has-no-border-radius-top-right is-a-lot-transparent">
                                                    ---
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                    <span class="icon">
                                                        <i class="fas fa-money-check"></i>
                                                    </span>
                                                    <span>Justificatifs</span>
                                                </span>
                                                <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                    aucuns
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                    <span class="icon">
                                                        <i class="fas fa-check-square"></i>
                                                    </span>
                                                    <span>Montant validé</span>
                                                </span>
                                                <span class="tag has-text-bigger has-text-success has-no-border-radius is-a-lot-transparent">
                                                    <strong>
                                                        + 0 €
                                                    </strong>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                    <span class="icon">
                                                        <i class="fas fa-hourglass-half"></i>
                                                    </span>
                                                    <span>État</span>
                                                </span>
                                                <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                    Non enregistré
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                    <span class="icon">
                                                        <i class="fas fa-file-alt"></i>
                                                    </span>
                                                    <span>N° Fiche</span>
                                                </span>
                                                <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                    ---
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger is-dark has-no-border-radius">
                                                    <span class="icon">
                                                        <i class="fas fa-money-bill"></i>
                                                    </span>
                                                    <span>Frais</span>
                                                </span>
                                                <span class="tag has-text-bigger has-text-danger has-no-border-radius is-a-lot-transparent">
                                                    <strong>
                                                    - 0 €
                                                    </strong>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger is-dark has-no-border-radius-bottom-left">
                                                    <span class="icon">
                                                        <i class="fas fa-money-bill"></i>
                                                    </span>
                                                    <span>Hors frais</span>
                                                </span>
                                                <span class="tag has-text-bigger has-text-danger has-border-radius-bottom-right is-a-lot-transparent">
                                                    <strong>
                                                        - 0 €
                                                    </strong>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div id="columnac0" class="column is-12 is-hidden content-fichefrais">
                                        <div class="box is-like-hero-background animate__animated animate__fadeIn">
                                            <div class="column has-no-padding has-background-transparent">
                                                <form onsubmit="return formSubmit(this);" class="has-text-left" action="{{path('addfichefrais')}}" method="POST">
                                                    <label class="label is-small is-aligned has-white-space-nowrap">Tarifs des distance des CV Fiscaux de votre Véhicule</label>
                                                    <div class="select is-small">
                                                        <select name="cv" required="required">
                                                            {% for uncvvehicule in cvvehicule %}
                                                                <option value="{{uncvvehicule.idcv}}">{{uncvvehicule.cv}} CV et plus de {{uncvvehicule.distancemaxcv}} km</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                    <div class="field has-addons">
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">Forfait Etape</label>
                                                            <input class="input is-small has-border-radius-left" type="number" placeholder="ETP" name="qtETP" required="required">
                                                            <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                        </p>
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">Frais Kilométrique</label>
                                                            <input class="input is-small" type="number" placeholder="KM" name="qtKM" required="required">
                                                            <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                        </p>
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">Nuitée Hôtel</label>
                                                            <input class="input is-small" type="number" placeholder="NUI" name="qtNUI" required="required">
                                                            <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                        </p>
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">Repas Restaurant</label>
                                                            <input class="input is-small" type="number" placeholder="REP" name="qtREP" required="required">
                                                            <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                        </p>
                                                        <p class="control">
                                                            <button id="buttonsaveac0" class="button is-small is-success has-no-margin-bottom" type="submit">
                                                                <SPAN>ENREGISTRER</SPAN>
                                                                <span id="" class="icon is-on-left">
                                                                        <i class="fas fa-save"></i>
                                                                    </span>
                                                            </button>
                                                        </p>
                                                    </div>
                                                    <hr>
                                                </form>
                                                <script>
                                                    $(document).ready(function(){
                                                        $('#buttonsaveac0').click(function (){
                                                            $('#buttonsaveac0').removeClass('').addClass('is-loading');
                                                        })
                                                    })
                                                </script>
                                                <script>
                                                    function formSubmit(form) {
                                                        document.getElementById("buttonsaveac0");
                                                        setTimeout(function() {
                                                            form.submit();
                                                        }, 1000);  // 1 secondes
                                                        return false;
                                                    }
                                                </script>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-14px-padding-top has-no-padding-bottom has-6px-padding-top-on-mobile">
                                        <span class="icon is-small">
                                            <i id="arrowac0" class="fas fa-chevron-down fa-lg grow cursor-pointer"></i>
                                        </span>
                                        <script>
                                            $(document).ready(function() {
                                                $("#arrowac0,#modifyac0").click(function () {
                                                    if ($("#arrowac0").hasClass("fa-chevron-down")) {

                                                        $("#arrowac0").removeClass('').addClass('unique');
                                                        $('#boxac0').removeClass('').addClass('unique');
                                                        $('#columnac0').removeClass('').addClass('unique');

                                                        if($('i[id*="arrowac"]').not("unique").hasClass('fa-chevron-up')){

                                                            $('i[id*="arrowac"]').not("unique").fadeOut(150, function () {
                                                                $('i[id*="arrowac"]').not("unique").removeClass('fa-chevron-up');
                                                                $('div[id*="boxac"]').not("unique").addClass('is-transparent').removeClass('is-asked-to-be-modified-past').height(280);

                                                                $('div[id*="columnac"]').not("unique").fadeOut(150, function () {
                                                                    $('div[id*="columnac"]').not("unique").addClass('is-hidden');

                                                                    $('i[id*="arrowac"]').not("unique").fadeIn(150, function () {
                                                                        $('i[id*="arrowac"]').not("unique").addClass('fa-chevron-down');
                                                                    });
                                                                });
                                                            });
                                                        }

                                                        $('#arrowac0').fadeOut(150, function () {
                                                            $('#arrowac0').removeClass('fa-chevron-down');

                                                            $('#columnac0').fadeIn(150, function (){
                                                                $('#columnac0').removeClass('is-hidden');

                                                                $('#arrowac0').fadeIn(150, function () {
                                                                    $('#arrowac0').addClass('fa-chevron-up');
                                                                    var newHeight = 340+$("#columnac0").height();
                                                                    $('#boxac0').addClass('is-asked-to-be-modified-current').height(newHeight).removeClass('is-transparent');

                                                                    $("#arrowac0").removeClass('unique');
                                                                    $('#boxac0').removeClass('unique');
                                                                    $('#columnac0').removeClass('unique');
                                                                });
                                                            });
                                                        });
                                                    } else {

                                                        $('#arrowac0').fadeOut(150, function () {
                                                            $('#arrowac0').removeClass('fa-chevron-up');
                                                            $('#boxac0').addClass('is-transparent');
                                                            $('#boxac0').removeClass('is-asked-to-be-modified-current').height(280);

                                                            $('#columnac0').fadeOut(150, function () {
                                                                $('#columnac0').addClass('is-hidden');

                                                                $('#arrowac0').fadeIn(150, function () {
                                                                    $('#arrowac0').addClass('fa-chevron-down');
                                                                });
                                                            });
                                                        });
                                                    }
                                                });
                                            });
                                        </script>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% for unefichefrais in fichesfraisanneecourante %}
                    {% if unefichefrais.date | format_datetime(pattern="YYYY-MM") == yearmonth %}
                    <div class="column is-3-desktop is-6-tablet is-12-mobile">
                        <div id="boxac{{loop.index}}" class="box is-transparent is-like-une-fiche-frais animate__animated animate__fadeIn">
                            <div class="column has-background-transparent">
                                <div class="is-relative">
                                    <div id="backgrounddeleteac{{loop.index}}" class="is-background-delete is-hidden">
                                        <div class="is-content-delete">
                                            <div class="is-text-delete">
                                                <div class="column">
                                                    <div class="column is-flex-mobile">
                                                        <div class="columns is-flex-mobile has-text-white">
                                                            <p>Voulez-vous vraiment supprimer la fiche de frais du mois de {{unefichefrais.date | format_datetime(pattern="MMMM", locale="fr") | upper}} {{ unefichefrais.date | format_datetime(pattern="YYYY") }}?</p>
                                                        </div>
                                                        <div class="columns is-flex-mobile">
                                                            <div class="column has-finest-padding-1024px has-6px-margin-right is-bigger-for-button-1024px">
                                                                    <button id="buttoncancelac{{loop.index}}" class="button is-fullwidth is-small is-info has-border-radius-40">
                                                                    <span class="icon">
                                                                        <i class="fas fa-ban"></i>
                                                                    </span>
                                                                    <span>ANNULER</span>
                                                                </button>
                                                            </div>
                                                            <div class="column has-finest-padding-1024px has-6px-margin-left is-bigger-for-button-1024px">
                                                                <form onsubmit="return formSubmit(this);" action="{{path('removefichefrais')}}" method="POST">
                                                                    <input class="is-hidden" type="text" value="{{unefichefrais.idfichefrais}}" name="idfichefrais">
                                                                    <button id="buttondeletevalidateac{{loop.index}}" class=" button is-fullwidth is-small is-danger has-border-radius-40" type="submit">
                                                                        <span>SUPPRIMER</span>
                                                                        <span class="icon">
                                                                             <i class="fas fa-trash-alt"></i>
                                                                        </span>
                                                                    </button>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px is-month-bar has-background-success">
                                            <span class="icon">
                                                <i class="fas fa-file-invoice"></i>
                                            </span>
                                            <span>
                                                <strong>{{unefichefrais.date | format_datetime(pattern="MMMM", locale="fr") | upper}} {{ unefichefrais.date | format_datetime(pattern="YYYY") }}</strong>
                                            </span>
                                            <span class="icon">
                                                <i class="fas fa-lock-open"></i>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="columns is-flex-mobile">
                                        <div class="column has-finest-padding-1024px has-6px-margin-right is-bigger-for-button-1024px">
                                            <button id="modifyac{{loop.index}}" class="button is-fullwidth is-small is-success has-border-radius-40">
                                                <span class="icon">
                                                    <i class="fas fa-edit"></i>
                                                </span>
                                                <span>MODIFIER</span>
                                            </button>
                                        </div>
                                        <div class="column has-finest-padding-1024px has-6px-margin-left is-bigger-for-button-1024px">
                                            <button id="buttondeleteac{{loop.index}}" class=" button is-fullwidth is-small is-danger has-border-radius-40">
                                                <span>SUPPRIMER</span>
                                                <script>
                                                    $(document).ready(function(){
                                                        $('#buttondeleteac{{loop.index}}').click(function (){
                                                            $('#backgrounddeleteac{{loop.index}}').removeClass('is-hidden').fadeIn(300, function (){});
                                                        })
                                                        $('#buttoncancelac{{loop.index}}').click(function (){
                                                            $('#backgrounddeleteac{{loop.index}}').fadeOut(150, function (){
                                                                $('#backgrounddeleteac{{loop.index}}').addClass('is-hidden');
                                                            });
                                                        })
                                                    })
                                                </script>
                                                <script>
                                                    $(document).ready(function(){
                                                        $('#buttondeletevalidateac{{loop.index}}').click(function (){
                                                            $('#buttondeletevalidateac{{loop.index}}').removeClass('').addClass('is-loading');
                                                        })
                                                    })
                                                </script>
                                                <script>
                                                    function formSubmit(form) {
                                                        document.getElementById("buttondeletevalidateac{{loop.index}}");
                                                        setTimeout(function() {
                                                            form.submit();
                                                        }, 1000);  // 1 secondes
                                                        return false;
                                                    }
                                                </script>
                                                <span class="icon">
                                                    <i class="fas fa-trash-alt"></i>
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger has-no-border-radius-top-left is-a-bit-transparent">
                                                    <span class="icon">
                                                        <i class="fas fa-calendar-alt"></i>
                                                    </span>
                                                    <span>Période</span>
                                                </span>
                                                <span class="tag has-text-bigger has-no-border-radius-top-right is-a-lot-transparent">
                                                    {{unefichefrais.date | date("m/Y")}}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                    <span class="icon">
                                                        <i class="fas fa-money-check"></i>
                                                    </span>
                                                    <span>Justificatifs</span>
                                                </span>
                                                <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                    {{unefichefrais.nbjustificatifs | default("aucuns")}}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                    <span class="icon">
                                                        <i class="fas fa-check-square"></i>
                                                    </span>
                                                    <span>Montant validé</span>
                                                </span>
                                                <span class="tag has-text-bigger has-text-success has-no-border-radius is-a-lot-transparent">
                                                    <strong>
                                                        + {{unefichefrais.montantvalide | default(0)}} €
                                                    </strong>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                    <span class="icon">
                                                        <i class="fas fa-hourglass-half"></i>
                                                    </span>
                                                    <span>État</span>
                                                </span>
                                                <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                    {{unefichefrais.idetat.libelleetat}}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                    <span class="icon">
                                                        <i class="fas fa-file-alt"></i>
                                                    </span>
                                                    <span>N° Fiche</span>
                                                </span>
                                                <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                    {{unefichefrais.idfichefrais}}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger is-dark has-no-border-radius">
                                                    <span class="icon">
                                                        <i class="fas fa-money-bill"></i>
                                                    </span>
                                                    <span>Frais</span>
                                                </span>
                                                <span class="tag has-text-bigger has-text-danger has-no-border-radius is-a-lot-transparent">
                                                    <strong>
                                                    - {{ unefichefrais.montanttotalfraisforfait }} €
                                                    </strong>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger is-dark has-no-border-radius-bottom-left">
                                                    <span class="icon">
                                                        <i class="fas fa-money-bill"></i>
                                                    </span>
                                                    <span>Hors frais</span>
                                                </span>
                                                <span class="tag has-text-bigger has-text-danger has-border-radius-bottom-right is-a-lot-transparent">
                                                    <strong>
                                                        {% if unefichefrais.montanttotalfraishorsforfait is defined %}
                                                            - {{ unefichefrais.montanttotalfraishorsforfait }} €
                                                        {% else %}
                                                            - 0 €
                                                        {% endif %}
                                                    </strong>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div id="columnac{{loop.index}}" class="column is-12 is-hidden content-fichefrais">
                                        <div class="box is-like-hero-background animate__animated animate__fadeIn">
                                            <div class="column has-no-padding has-background-transparent">
                                                <form onsubmit="return formSubmit(this);" class="has-text-left" action="{{path('setfraisforfait')}}" method="POST">
                                                    <div class="field has-addons">
                                                        <p>
                                                            <label class="label is-small is-aligned has-white-space-nowrap">Tarifs des distance des CV Fiscaux de votre Véhicule</label>
                                                            <input class="input is-small has-border-radius" type="text"  value="{{ unefichefrais.idcv.cv}} CV et plus de {{ unefichefrais.idcv.distancemaxcv }}" disabled>
                                                        </p>
                                                    </div>
                                                    <div class="field has-addons">
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.ETP.idfraisforfait.libellefraisforfait }}</label>
                                                            <input class="input is-small has-border-radius-left" type="number" placeholder="{{ unefichefrais.ETP.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.ETP.quantite }}" name="qtETP" required="required">
                                                            <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                            <label class="label is-small is-aligned has-8px-margin-top">{{ unefichefrais.ETP.idfraisforfait.montantfraisforfait }}</label>
                                                            <label class="label is-small is-aligned">{{ unefichefrais.ETP.quantite * unefichefrais.ETP.idfraisforfait.montantfraisforfait }}</label>
                                                        </p>
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.KM.idfraisforfait.libellefraisforfait }}</label>
                                                            <input class="input is-small" type="number" placeholder="{{ unefichefrais.KM.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.KM.quantite }}" name="qtKM" required="required">
                                                            <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                            <label class="label is-small is-aligned has-8px-margin-top">({{ unefichefrais.KM.quantite }} x {{ unefichefrais.idcv.facteurcv}}) + {{ unefichefrais.idcv.constantecv }}</label>
                                                            <label class="label is-small is-aligned">{{ unefichefrais.KM.quantite * unefichefrais.idcv.facteurcv + unefichefrais.idcv.constantecv }}</label>
                                                        </p>
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.NUI.idfraisforfait.libellefraisforfait }}</label>
                                                            <input class="input is-small" type="number" placeholder="{{ unefichefrais.NUI.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.NUI.quantite }}" name="qtNUI" required="required">
                                                            <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                            <label class="label is-small is-aligned has-8px-margin-top">{{ unefichefrais.NUI.idfraisforfait.montantfraisforfait }}</label>
                                                            <label class="label is-small is-aligned">{{ unefichefrais.NUI.quantite * unefichefrais.NUI.idfraisforfait.montantfraisforfait }}</label>
                                                        </p>
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.REP.idfraisforfait.libellefraisforfait }}</label>
                                                            <input class="input is-small" type="number" placeholder="{{ unefichefrais.REP.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.REP.quantite }}" name="qtREP" required="required">
                                                            <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                            <label class="label is-small is-aligned has-8px-margin-top">{{ unefichefrais.REP.idfraisforfait.montantfraisforfait }}</label>
                                                            <label class="label is-small is-aligned">{{ unefichefrais.REP.quantite * unefichefrais.REP.idfraisforfait.montantfraisforfait }}</label>
                                                        </p>
                                                        <p class="control">
                                                            <input class="is-hidden" type="text" value="{{unefichefrais.idfichefrais}}" name="idfichefrais">
                                                            <button id="buttonsaveac{{loop.index}}" class="button is-small is-success has-no-margin-bottom" type="submit">
                                                                <SPAN>ENREGISTRER</SPAN>
                                                                <span class="icon is-on-left">
                                                                        <i class="fas fa-save"></i>
                                                                    </span>
                                                            </button>
                                                            <label class="label is-small is-aligned has-8px-margin-top">Montant</label>
                                                            <label class="label is-small is-aligned">Total</label>
                                                        </p>
                                                    </div>
                                                </form>
                                                <hr>
                                                <form onsubmit="return formSubmit(this);" class="has-text-left has-no-margin-bottom" action="{{path('setfraishorsforfait')}}" method="POST">
                                                    <div class="field has-addons has-no-margin-bottom">
                                                        <p id='inputdateac{{loop.index}}' class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">Date</label>
                                                            {% if unefichefrais.lignesfraishorsforfait is defined %}
                                                            {% for unelignefraishorsforfait in unefichefrais.lignesfraishorsforfait %}
                                                                <input id="inputdatefhfac{{ loop.index }}" class="input is-small has-4px-margin-bottom has-border-radius-left" type="date" value="{{ unelignefraishorsforfait.date | date("Y-m-d")}}" name="dateFHF[]" required="required">
                                                            {% endfor %}
                                                            {% else %}
                                                                <input class="input is-small has-4px-margin-bottom has-border-radius-left" type="date" placeholder="Date" name="dateFHF[]">
                                                            {% endif %}
                                                            <span id="spandatefhfac{{ loop.index }}" class="icon is-aligned is-small is-left">
                                                                <i class="fas fa-edit"></i>
                                                            </span>

                                                        </p>
                                                        <p id='inputlibelleac{{loop.index}}' class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">Libelle</label>
                                                            {% if unefichefrais.lignesfraishorsforfait is defined %}
                                                            {% for unelignefraishorsforfait in unefichefrais.lignesfraishorsforfait %}
                                                                <input id="inputlibellefhfac{{ loop.index }}" class="input is-small has-4px-margin-bottom" type="text" placeholder="Libelle" value="{{ unelignefraishorsforfait.libelle }}" name="libelleFHF[]" required="required">
                                                            {% endfor %}
                                                            {% else %}
                                                                <input class="input is-small has-4px-margin-bottom" type="text" placeholder="Libelle" name="libelleFHF[]">
                                                            {% endif %}
                                                            <span id="spanlibellefhfac{{ loop.index }}" class="icon is-aligned is-small is-left">
                                                                <i class="fas fa-edit"></i>
                                                            </span>

                                                        </p>
                                                        <p id="inputmontantac{{loop.index}}" class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">Montant</label>
                                                            {% if unefichefrais.lignesfraishorsforfait is defined %}
                                                            {% for unelignefraishorsforfait in unefichefrais.lignesfraishorsforfait %}
                                                                <input id="inputmontantfhfac{{ loop.index }}" class="input is-small has-4px-margin-bottom has-right-button" pattern="^\d*(\.\d{0,2})?$" placeholder="Montant" value="{{ unelignefraishorsforfait.montant }}" name="montantFHF[]" required="required">
                                                                <a id="buttondeletefhfac{{ loop.index }}" class="button buttondeletefhf is-small is-danger">
                                                                    <span>SUPPRIMER <i class="fas fa-trash-alt"></i></span>
                                                                </a>
                                                                <script>
                                                                    $(document).ready(function (){
                                                                        $("#buttondeletefhfac{{ loop.index }}").click(function (){
                                                                            $("#inputdatefhfac{{ loop.index }}").remove();
                                                                            $("#spandatefhfac{{ loop.index }}").remove();
                                                                            $("#inputlibellefhfac{{ loop.index }}").remove();
                                                                            $("#spanlibellefhfac{{ loop.index }}").remove();
                                                                            $("#inputmontantfhfac{{ loop.index }}").remove();
                                                                            $("#spanmontantfhfac{{ loop.index }}").remove();
                                                                            $("#buttondeletefhfac{{ loop.index }}").remove();
                                                                        });
                                                                    });
                                                                </script>
                                                            {% endfor %}
                                                            {% else %}
                                                                <input class="input is-small has-4px-margin-bottom" pattern="^\d*(\.\d{0,2})?$" placeholder="00.00" name="montantFHF[]" required="required">
                                                            {% endif %}
                                                            <span id="spanmontantfhfac{{ loop.index }}" class="icon is-aligned is-small is-left">
                                                                <i class="fas fa-edit"></i>
                                                            </span>

                                                        </p>
                                                        <p class="control">
                                                            <input class="is-hidden" type="text" value="{{unefichefrais.idfichefrais}}" name="idfichefrais">
                                                            <div class="button-div">
                                                            <button id="buttonsavefhfac{{loop.index}}" class="button is-small is-success is-full" type="submit">
                                                                <span>ENREGISTRER</span>
                                                                <span class="icon is-on-left">
                                                                    <i class="fas fa-save"></i>
                                                                </span>
                                                            </button>
                                                            <script>
                                                                $(document).ready(function(){
                                                                    $('#buttonsavefhfac{{loop.index}}').click(function (){
                                                                        $('#buttonsavefhfac{{loop.index}}').removeClass('').addClass('is-loading');
                                                                    });
                                                                });
                                                            </script>
                                                            </div>
                                                        </p>
                                                    </div>
                                                    <div class="field has-addons">
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap has-2px-margin-top">
                                                                Total
                                                            </label>
                                                        </p>
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap has-2px-margin-top">
                                                            </label>
                                                        </p>
                                                        <p class="control has-icons-left is-expanded">
                                                            <a id='buttonaddac{{loop.index}}' class="button-add">
                                                                <span class="icon is-small span-add">
                                                                    <i class="fas fa-plus-circle grow cursor-pointer"></i>
                                                                </span>
                                                            </a>
                                                            <label class="label is-small is-aligned has-white-space-nowrap has-2px-margin-top">
                                                                {% if unefichefrais.montanttotalfraishorsforfait is defined %}
                                                                    {{ unefichefrais.montanttotalfraishorsforfait }} €
                                                                {% else %}
                                                                    0 €
                                                                {% endif %}
                                                            </label>
                                                        </p>
                                                    </div>
                                                </form>
                                                <script>
                                                    $(document).ready(function (){
                                                        let count = 0;
                                                        $('#buttonaddac{{loop.index}}').click(function (){
                                                            $('#inputdateac{{loop.index}}').append("<input id='inputdateaddac" + count + "' class='input is-small has-4px-margin-bottom has-border-radius-left' type='date' placeholder='Date' name='dateFHF[]' required='required'>");
                                                            $('#inputlibelleac{{loop.index}}').append("<input id='inputlibelleaddac" + count + "' class='input is-small has-4px-margin-bottom' type='text' placeholder='Libelle' name='libelleFHF[]' required='required'>");
                                                            $('#inputmontantac{{loop.index}}').append("<input id='inputmontantaddac" + count + "' class='input is-small has-4px-margin-bottom has-right-button' pattern='^\\d*(\\.\\d{0,2})?$' placeholder='00.00' name='montantFHF[]' required='required'><a onclick = 'deletebuttoninputaddac("+ count +")' id='buttoninputaddac"+ count +"' class='button buttondeletefhf is-small is-danger'><span>SUPPRIMER <i class='fas fa-trash-alt'></i></span></a>");
                                                            count++;
                                                        });
                                                    });
                                                </script>
                                                <script>
                                                    $(document).ready(function(){
                                                        $('#buttonsaveac{{loop.index}}').click(function (){
                                                            $('#buttonsaveac{{loop.index}}').removeClass('').addClass('is-loading');
                                                        });
                                                    });
                                                </script>
                                                <script>
                                                    function formSubmit(form) {
                                                        document.getElementById("buttonsaveac{{loop.index}}");
                                                        setTimeout(function() {
                                                            form.submit();
                                                        }, 1000);  // 1 secondes
                                                        return false;
                                                    }
                                                </script>
                                                <script>
                                                    function deletebuttoninputaddac(int) {
                                                        $("#inputlibelleaddac" + int + "").remove();
                                                        $("#inputdateaddac" + int + "").remove();
                                                        $("#inputmontantaddac" + int + "").remove();
                                                        $("#buttoninputaddac" + int + "").remove();
                                                        $("#spancurrencyfhfac" + int + "").remove();
                                                    }
                                                </script>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-14px-padding-top has-6px-padding-top-on-mobile">
                                        <span class="icon is-small">
                                            <i id="arrowac{{loop.index}}" class="fas fa-chevron-down fa-lg grow cursor-pointer"></i>
                                        </span>
                                        <script>
                                            $(document).ready(function() {
                                                $("#arrowac{{loop.index}},#modifyac{{loop.index}}").click(function () {
                                                    if ($("#arrowac{{loop.index}}").hasClass("fa-chevron-down")) {

                                                        $("#arrowac{{loop.index}}").removeClass('').addClass("unique");
                                                        $('#boxac{{loop.index}}').removeClass('').addClass('unique');
                                                        $('#columnac{{loop.index}}').removeClass('').addClass('unique');

                                                        if($('i[id*="arrowac"]').not("unique").hasClass('fa-chevron-up')){

                                                            $('i[id*="arrowac"]').not("unique").fadeOut(150, function () {
                                                                $('i[id*="arrowac"]').not("unique").removeClass('fa-chevron-up');
                                                                $('div[id*="boxac"]').not("unique").addClass('is-transparent').removeClass('is-asked-to-be-modified-past').removeClass('is-asked-to-be-modified-current').height(280);

                                                                $('div[id*="columnac"]').not("unique").fadeOut(150, function () {
                                                                    $('div[id*="columnac"]').not("unique").addClass('is-hidden');

                                                                    $('i[id*="arrowac"]').not("unique").fadeIn(150, function () {
                                                                        $('i[id*="arrowac"]').not("unique").addClass('fa-chevron-down');
                                                                    });
                                                                });
                                                            });
                                                        }

                                                        $('#arrowac{{loop.index}}').fadeOut(150, function () {
                                                            $('#arrowac{{loop.index}}').removeClass('fa-chevron-down');

                                                            $('#columnac{{loop.index}}').removeClass('is-hidden').fadeIn(150, function (){

                                                                $('#arrowac{{loop.index}}').fadeIn(150, function () {
                                                                    $('#arrowac{{loop.index}}').addClass('fa-chevron-up');
                                                                    var newHeight = 340+$("#columnac{{loop.index}}").height();
                                                                    $('#boxac{{loop.index}}').addClass('is-asked-to-be-modified-current').height(newHeight).removeClass('is-transparent');

                                                                    $("#arrowac{{loop.index}}").removeClass("unique");
                                                                    $('#boxac{{loop.index}}').removeClass('unique');
                                                                    $('#columnac{{loop.index}}').removeClass('unique');
                                                                });
                                                            });
                                                        });
                                                    } else {

                                                        $('#arrowac{{loop.index}}').fadeOut(150, function () {
                                                            $('#arrowac{{loop.index}}').removeClass('fa-chevron-up');
                                                            $('#boxac{{loop.index}}').addClass('is-transparent').removeClass('is-asked-to-be-modified-current').height(280);

                                                            $('#columnac{{loop.index}}').fadeOut(150, function () {
                                                                $('#columnac{{loop.index}}').addClass('is-hidden');

                                                                $('#arrowac{{loop.index}}').fadeIn(150, function () {
                                                                    $('#arrowac{{loop.index}}').addClass('fa-chevron-down');
                                                                });
                                                            });
                                                        });
                                                    }
                                                });
                                            });
                                        </script>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="column is-3-desktop is-6-tablet is-12-mobile">
                        <div id="boxac{{loop.index}}" class="box is-transparent is-like-une-fiche-frais animate__animated animate__fadeIn">
                            <div class="column has-background-transparent">
                                <div class="is-relative">
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px is-month-bar has-background-warning">
                                            <span class="icon">
                                                <i class="fas fa-file-invoice"></i>
                                            </span>
                                            <span>
                                                <strong>{{unefichefrais.date | format_datetime(pattern="MMMM", locale="fr") | upper}} {{ unefichefrais.date | format_datetime(pattern="YYYY") }}</strong>
                                            </span>
                                            <span class="icon">
                                                <i class="fas fa-lock"></i>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="columns is-flex-mobile">
                                        <div class="column has-finest-padding-1024px has-6px-margin-right is-bigger-for-button-1024px">
                                            <button id="addac{{loop.index}}" class="button is-fullwidth is-small is-info has-border-radius-40">
                                                <span class="icon is-on-left">
                                                    <i class="fas fa-plus-square"></i>
                                                </span>
                                                <span>AJOUTER</span>
                                            </button>
                                        </div>
                                        <div class="column has-finest-padding-1024px has-6px-margin-left is-bigger-for-button-1024px">
                                            <button id="consultac{{loop.index}}" class="button is-fullwidth is-small is-carefull is-dark has-border-radius-40">
                                                <span>CONSULTER</span>
                                                <span class="icon">
                                                    <i class="fas fa-eye"></i>
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger has-no-border-radius-top-left is-a-bit-transparent">
                                                    <span class="icon">
                                                        <i class="fas fa-calendar-alt"></i>
                                                    </span>
                                                    <span>Période</span>
                                                </span>
                                                <span class="tag has-text-bigger has-no-border-radius-top-right is-a-lot-transparent">
                                                    {{unefichefrais.date | date("m/Y")}}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                    <span class="icon">
                                                        <i class="fas fa-money-check"></i>
                                                    </span>
                                                    <span>Justificatifs</span>
                                                </span>
                                                <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                    {{unefichefrais.nbjustificatifs | default("aucuns")}}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                    <span class="icon">
                                                        <i class="fas fa-check-square"></i>
                                                    </span>
                                                    <span>Montant validé</span>
                                                </span>
                                                <span class="tag has-text-bigger has-text-success has-no-border-radius is-a-lot-transparent">
                                                    <strong>
                                                        + {{unefichefrais.montantvalide | default(0)}} €
                                                    </strong>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                    <span class="icon">
                                                        <i class="fas fa-hourglass-half"></i>
                                                    </span>
                                                    <span>État</span>
                                                </span>
                                                <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                    {{unefichefrais.idetat.libelleetat}}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                    <span class="icon">
                                                        <i class="fas fa-file-alt"></i>
                                                    </span>
                                                    <span>N° Fiche</span>
                                                </span>
                                                <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                    {{unefichefrais.idfichefrais}}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger is-dark has-no-border-radius">
                                                    <span class="icon">
                                                        <i class="fas fa-money-bill"></i>
                                                    </span>
                                                    <span>Frais</span>
                                                </span>
                                                <span class="tag has-text-bigger has-text-danger has-no-border-radius is-a-lot-transparent">
                                                    <strong>
                                                        - {{ unefichefrais.montanttotalfraisforfait }} €
                                                    </strong>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                                <span class="tag has-text-bigger is-dark has-no-border-radius-bottom-left">
                                                    <span class="icon">
                                                        <i class="fas fa-money-bill"></i>
                                                    </span>
                                                    <span>Hors frais</span>
                                                </span>
                                                <span class="tag has-text-bigger has-text-danger has-border-radius-bottom-right is-a-lot-transparent">
                                                    <strong>
                                                        {% if unefichefrais.montanttotalfraishorsforfait is defined %}
                                                            - {{ unefichefrais.montanttotalfraishorsforfait }} €
                                                        {% else %}
                                                            - 0 €
                                                        {% endif %}
                                                    </strong>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div id="columnac{{loop.index}}" class="column is-12 is-hidden content-fichefrais">
                                        <div class="box is-like-hero-background animate__animated animate__fadeIn">
                                            <div class="column has-no-padding has-background-transparent">
                                                <form onsubmit="" class="has-text-left" action="" method="POST">
                                                    <div class="field has-addons">
                                                        <p>
                                                            <label class="label is-small is-aligned has-white-space-nowrap">Tarifs des distance des CV Fiscaux de votre Véhicule</label>
                                                            <input class="input is-small has-border-radius" type="text"  value="{{ unefichefrais.idcv.cv}} CV et plus de {{ unefichefrais.idcv.distancemaxcv }}" disabled>
                                                        </p>
                                                    </div>
                                                    <div class="field has-addons">
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.ETP.idfraisforfait.libellefraisforfait }}</label>
                                                            <input class="input is-small has-border-radius-left" type="number" placeholder="{{ unefichefrais.ETP.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.ETP.quantite }}" name="qtETP" required="required" disabled>
                                                            <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                            <label class="label is-small is-aligned has-8px-margin-top">{{ unefichefrais.ETP.idfraisforfait.montantfraisforfait }}</label>
                                                            <label class="label is-small is-aligned">{{ unefichefrais.ETP.quantite * unefichefrais.ETP.idfraisforfait.montantfraisforfait }}</label>
                                                        </p>
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.KM.idfraisforfait.libellefraisforfait }}</label>
                                                            <input class="input is-small" type="number" placeholder="{{ unefichefrais.KM.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.KM.quantite }}" name="qtKM" required="required" disabled>
                                                            <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                            <label class="label is-small is-aligned has-8px-margin-top">({{ unefichefrais.KM.quantite }} x {{ unefichefrais.idcv.facteurcv}}) + {{ unefichefrais.idcv.constantecv }}</label>
                                                            <label class="label is-small is-aligned">{{ unefichefrais.KM.quantite * unefichefrais.idcv.facteurcv + unefichefrais.idcv.constantecv }}</label>
                                                        </p>
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.NUI.idfraisforfait.libellefraisforfait }}</label>
                                                            <input class="input is-small" type="number" placeholder="{{ unefichefrais.NUI.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.NUI.quantite }}" name="qtNUI" required="required" disabled>
                                                            <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                            <label class="label is-small is-aligned has-8px-margin-top">{{ unefichefrais.NUI.idfraisforfait.montantfraisforfait }}</label>
                                                            <label class="label is-small is-aligned">{{ unefichefrais.NUI.quantite * unefichefrais.NUI.idfraisforfait.montantfraisforfait }}</label>
                                                        </p>
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.REP.idfraisforfait.libellefraisforfait }}</label>
                                                            <input class="input is-small" type="number" placeholder="{{ unefichefrais.REP.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.REP.quantite }}" name="qtREP" required="required" disabled>
                                                            <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                            <label class="label is-small is-aligned has-8px-margin-top">{{ unefichefrais.REP.idfraisforfait.montantfraisforfait }}</label>
                                                            <label class="label is-small is-aligned">{{ unefichefrais.REP.quantite * unefichefrais.REP.idfraisforfait.montantfraisforfait }}</label>
                                                        </p>
                                                        <p class="control">
                                                            <input class="is-hidden" type="text" value="{{unefichefrais.idfichefrais}}" name="idfichefrais" disabled>
                                                            <button id="buttonsaveac{{loop.index}}" class="button is-small is-success has-no-margin-bottom" type="submit" disabled>
                                                                <SPAN>ENREGISTRER</SPAN>
                                                                <span id="" class="icon is-on-left">
                                                                        <i class="fas fa-save"></i>
                                                                    </span>
                                                            </button>
                                                            <label class="label is-small is-aligned has-8px-margin-top">Montant</label>
                                                            <label class="label is-small is-aligned">Total</label>
                                                        </p>
                                                    </div>
                                                </form>
                                                <hr>
                                                <form onsubmit="" class="has-text-left has-no-margin-bottom" action="" method="POST">
                                                    <div class="field has-addons has-no-margin-bottom">
                                                        <p id='inputdateac{{loop.index}}' class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">Date</label>
                                                            {% if unefichefrais.lignesfraishorsforfait is defined %}
                                                                {% for unelignefraishorsforfait in unefichefrais.lignesfraishorsforfait %}
                                                                    <input id="inputdatefhfac{{ loop.index }}" class="input is-small has-4px-margin-bottom has-border-radius-left" type="date" value="{{ unelignefraishorsforfait.date | date("Y-m-d")}}" name="dateFHF[]" required="required" disabled>
                                                                {% endfor %}
                                                            {% else %}
                                                                <input class="input is-small has-4px-margin-bottom has-border-radius-left" type="date" placeholder="Date" name="dateFHF[]" disabled>
                                                            {% endif %}
                                                            <span id="spandatefhfac{{ loop.index }}" class="icon is-aligned is-small is-left">
                                                                <i class="fas fa-edit"></i>
                                                            </span>

                                                        </p>
                                                        <p id='inputlibelleac{{loop.index}}' class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">Libelle</label>
                                                            {% if unefichefrais.lignesfraishorsforfait is defined %}
                                                                {% for unelignefraishorsforfait in unefichefrais.lignesfraishorsforfait %}
                                                                    <input id="inputlibellefhfac{{ loop.index }}" class="input is-small has-4px-margin-bottom" type="text" placeholder="Libelle" value="{{ unelignefraishorsforfait.libelle }}" name="libelleFHF[]" required="required" disabled>
                                                                {% endfor %}
                                                            {% else %}
                                                                <input class="input is-small has-4px-margin-bottom" type="text" placeholder="Libelle" name="libelleFHF[]" disabled>
                                                            {% endif %}
                                                            <span id="spanlibellefhfac{{ loop.index }}" class="icon is-aligned is-small is-left">
                                                                <i class="fas fa-edit"></i>
                                                            </span>

                                                        </p>
                                                        <p id="inputmontantac{{loop.index}}" class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap">Montant</label>
                                                            {% if unefichefrais.lignesfraishorsforfait is defined %}
                                                                {% for unelignefraishorsforfait in unefichefrais.lignesfraishorsforfait %}
                                                            <input id="inputmontantfhfac{{ loop.index }}" class="input is-small has-4px-margin-bottom has-right-button" pattern="^\d*(\.\d{0,2})?$" placeholder="Montant" value="{{ unelignefraishorsforfait.montant }}" name="montantFHF[]" required="required" disabled>
                                                                <a id="buttondeletefhfac{{ loop.index }}" class="button buttondeletefhf is-small is-danger" disabled>
                                                                    <span>SUPPRIMER <i class="fas fa-trash-alt"></i></span>
                                                                </a>
                                                                {% endfor %}
                                                            {% else %}
                                                            <input class="input is-small has-4px-margin-bottom" pattern="^\d*(\.\d{0,2})?$" placeholder="00.00" name="montantFHF[]" required="required" disabled>
                                                            {% endif %}
                                                            <span id="spanmontantfhfac{{ loop.index }}" class="icon is-aligned is-small is-left">
                                                                <i class="fas fa-edit"></i>
                                                            </span>

                                                        </p>
                                                        <p class="control">
                                                            <input class="is-hidden" type="text" value="{{unefichefrais.idfichefrais}}" name="idfichefrais" disabled>
                                                        <div class="button-div">
                                                            <button id="buttonsavefhfac{{loop.index}}" class="button is-small is-success is-full" type="submit" disabled>
                                                                <span>ENREGISTRER</span>
                                                                <span class="icon is-on-left">
                                                                    <i class="fas fa-save"></i>
                                                                </span>
                                                            </button>
                                                        </div>
                                                        </p>
                                                    </div>
                                                    <div class="field has-addons">
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap has-2px-margin-top">
                                                                Total
                                                            </label>
                                                        </p>
                                                        <p class="control has-icons-left is-expanded">
                                                            <label class="label is-small is-aligned has-white-space-nowrap has-2px-margin-top">
                                                            </label>
                                                        </p>
                                                        <p class="control has-icons-left is-expanded">
                                                            <a id='buttonaddac{{loop.index}}' class="button-add">
                                                                <span class="icon is-small span-add">
                                                                    <i class="fas fa-plus-circle"></i>
                                                                </span>
                                                            </a>
                                                            <label class="label is-small is-aligned has-white-space-nowrap has-2px-margin-top">
                                                                {% if unefichefrais.montanttotalfraishorsforfait is defined %}
                                                                    {{ unefichefrais.montanttotalfraishorsforfait }} €
                                                                {% else %}
                                                                    0 €
                                                                {% endif %}
                                                            </label>
                                                        </p>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-14px-padding-top has-no-padding-bottom has-6px-padding-top-on-mobile">
                                        <span class="icon is-small">
                                            <i id="arrowac{{loop.index}}" class="fas fa-chevron-down fa-lg grow cursor-pointer"></i>
                                        </span>
                                        <script>
                                            $(document).ready(function() {
                                                $("#arrowac{{loop.index}},#addac{{ loop.index }},#consultac{{loop.index}}").click(function () {
                                                    if ($("#arrowac{{loop.index}}").hasClass("fa-chevron-down")) {

                                                        $("#arrowac{{loop.index}}").addClass("unique");
                                                        $('#boxac{{loop.index}}').addClass('unique');
                                                        $('#columnac{{loop.index}}').addClass('unique');

                                                        if($('i[id*="arrowac"]').not("unique").hasClass('fa-chevron-up')){

                                                            $('i[id*="arrowac"]').not("unique").fadeOut(150, function () {
                                                                $('i[id*="arrowac"]').not("unique").removeClass('fa-chevron-up');
                                                                $('div[id*="boxac"]').not("unique").addClass('is-transparent').removeClass('is-asked-to-be-modified-past').removeClass('is-asked-to-be-modified-current').height(280);

                                                                $('div[id*="columnac"]').not(".unique").fadeOut(150, function () {
                                                                    $('div[id*="columnac"]').not(".unique").addClass('is-hidden');

                                                                    $('i[id*="arrowac"]').not(".unique").fadeIn(150, function () {
                                                                        $('i[id*="arrowac"]').not(".unique").addClass('fa-chevron-down');
                                                                    });
                                                                });
                                                            });
                                                        }

                                                        $('#arrowac{{loop.index}}').fadeOut(150, function () {
                                                            $('#arrowac{{loop.index}}').removeClass('fa-chevron-down');

                                                            $('#columnac{{loop.index}}').fadeIn(150, function (){
                                                                $('#columnac{{loop.index}}').removeClass('is-hidden');

                                                                $('#arrowac{{loop.index}}').fadeIn(150, function () {
                                                                    $('#arrowac{{loop.index}}').addClass('fa-chevron-up');
                                                                    var newHeight = 340+$("#columnac{{loop.index}}").height();
                                                                    $('#boxac{{loop.index}}').addClass('is-asked-to-be-modified-past').height(newHeight).removeClass('is-transparent');

                                                                    $("#arrowac{{loop.index}}").removeClass("unique");
                                                                    $('#boxac{{loop.index}}').removeClass('unique');
                                                                    $('#columnac{{loop.index}}').removeClass('unique');
                                                                });
                                                            });
                                                        });
                                                    } else {

                                                        $('#arrowac{{loop.index}}').fadeOut(150, function () {
                                                            $('#arrowac{{loop.index}}').removeClass('fa-chevron-up');
                                                            $('#boxac{{loop.index}}').addClass('is-transparent').removeClass('is-asked-to-be-modified-past').height(280);

                                                            $('#columnac{{loop.index}}').fadeOut(150, function () {
                                                                $('#columnac{{loop.index}}').addClass('is-hidden');

                                                                $('#arrowac{{loop.index}}').fadeIn(150, function () {
                                                                    $('#arrowac{{loop.index}}').addClass('fa-chevron-down');
                                                                });
                                                            });
                                                        });
                                                    }
                                                });
                                            });
                                        </script>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        <div id="columnpast" class="columns is-10 is-centered is-multiline is-hidden">
            <div class="column is-12">
                <div class="columns is-multiline">
                    {% for unefichefrais in fichesfraisanneepasse %}
                        <div class="column is-3-desktop is-6-tablet is-12-mobile">
                            <div id="boxap{{loop.index}}" class="box is-transparent is-like-une-fiche-frais animate__animated animate__fadeIn">
                                <div class="column has-background-transparent">
                                    <div class="is-relative">
                                        <div class="columns">
                                            <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px is-month-bar has-background-warning">
                                                <span class="icon">
                                                    <i class="fas fa-file-invoice"></i>
                                                </span>
                                                <span>
                                                    <strong>{{unefichefrais.date | format_datetime(pattern="MMMM", locale="fr") | upper}} {{ unefichefrais.date | format_datetime(pattern="YYYY") }}</strong>
                                                </span>
                                                <span class="icon">
                                                    <i class="fas fa-lock"></i>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="columns is-flex-mobile">
                                            <div class="column has-finest-padding-1024px has-6px-margin-right is-bigger-for-button-1024px">
                                                <button id="addap{{loop.index}}" class="button is-fullwidth is-small is-info has-border-radius-40">
                                                    <span class="icon is-on-left">
                                                        <i class="fas fa-plus-square"></i>
                                                    </span>
                                                    <span>AJOUTER</span>
                                                </button>
                                            </div>
                                            <div class="column has-finest-padding-1024px has-6px-margin-left is-bigger-for-button-1024px">
                                                <button id="consultap{{loop.index}}" class="button is-fullwidth is-small is-carefull is-dark has-border-radius-40">
                                                    <span>CONSULTER</span>
                                                    <span class="icon">
                                                        <i class="fas fa-eye"></i>
                                                    </span>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="columns">
                                            <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                                <div class="tags has-addons">
                                                    <span class="tag has-text-bigger has-no-border-radius-top-left is-a-bit-transparent">
                                                        <span class="icon">
                                                            <i class="fas fa-calendar-alt"></i>
                                                        </span>
                                                        <span>Période</span>
                                                    </span>
                                                    <span class="tag has-text-bigger has-no-border-radius-top-right is-a-lot-transparent">
                                                        {{unefichefrais.date | date("m/Y")}}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="columns">
                                            <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                                <div class="tags has-addons">
                                                    <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                        <span class="icon">
                                                            <i class="fas fa-money-check"></i>
                                                        </span>
                                                        <span>Justificatifs</span>
                                                    </span>
                                                    <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                        {{unefichefrais.nbjustificatifs | default("aucuns")}}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="columns">
                                            <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                                <div class="tags has-addons">
                                                    <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                        <span class="icon">
                                                            <i class="fas fa-check-square"></i>
                                                        </span>
                                                        <span>Montant validé</span>
                                                    </span>
                                                    <span class="tag has-text-bigger has-text-success has-no-border-radius is-a-lot-transparent">
                                                        <strong>
                                                            + {{unefichefrais.montantvalide | default(0)}} €
                                                        </strong>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="columns">
                                            <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                                <div class="tags has-addons">
                                                    <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                        <span class="icon">
                                                            <i class="fas fa-hourglass-half"></i>
                                                        </span>
                                                        <span>État</span>
                                                    </span>
                                                    <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                        {{unefichefrais.idetat.libelleetat}}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="columns">
                                            <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                                <div class="tags has-addons">
                                                    <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                        <span class="icon">
                                                            <i class="fas fa-file-alt"></i>
                                                        </span>
                                                        <span>N° Fiche</span>
                                                    </span>
                                                    <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                        {{unefichefrais.idfichefrais}}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="columns">
                                            <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                                <div class="tags has-addons">
                                                    <span class="tag has-text-bigger is-dark has-no-border-radius">
                                                        <span class="icon">
                                                            <i class="fas fa-money-bill"></i>
                                                        </span>
                                                        <span>Frais</span>
                                                    </span>
                                                    <span class="tag has-text-bigger has-text-danger has-no-border-radius is-a-lot-transparent">
                                                        <strong>
                                                            - {{ unefichefrais.montanttotalfraisforfait }} €
                                                        </strong>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="columns">
                                            <div class="column has-2px-padding-top has-finest-padding-1024px">
                                                <div class="tags has-addons">
                                                    <span class="tag has-text-bigger is-dark has-no-border-radius-bottom-left">
                                                        <span class="icon">
                                                            <i class="fas fa-money-bill"></i>
                                                        </span>
                                                        <span>Hors frais</span>
                                                    </span>
                                                    <span class="tag has-text-bigger has-text-danger has-border-radius-bottom-right is-a-lot-transparent">
                                                        <strong>
                                                            {% if unefichefrais.montanttotalfraishorsforfait is defined %}
                                                                - {{ unefichefrais.montanttotalfraishorsforfait }} €
                                                            {% else %}
                                                                - 0 €
                                                            {% endif %}
                                                        </strong>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div id="columnap{{loop.index}}" class="column is-12 is-hidden content-fichefrais">
                                            <div class="box is-like-hero-background animate__animated animate__fadeIn">
                                                <div class="column has-no-padding has-background-transparent">
                                                    <form onsubmit="" class="has-text-left" action="">
                                                        <div class="field has-addons">
                                                            <p>
                                                                <label class="label is-small is-aligned has-white-space-nowrap">Tarifs des distance des CV Fiscaux de votre Véhicule</label>
                                                                <input class="input is-small has-border-radius" type="text"  value="{{ unefichefrais.idcv.cv}} CV et plus de {{ unefichefrais.idcv.distancemaxcv }}" disabled>
                                                            </p>
                                                        </div>
                                                        <div class="field has-addons">
                                                            <p class="control has-icons-left is-expanded">
                                                                <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.ETP.idfraisforfait.libellefraisforfait }}</label>
                                                                <input class="input is-small has-border-radius-left" type="number" placeholder="{{ unefichefrais.ETP.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.ETP.quantite }}" name="qtETP" required="required" disabled>
                                                                <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                                <label class="label is-small is-aligned has-8px-margin-top">{{ unefichefrais.ETP.idfraisforfait.montantfraisforfait }}</label>
                                                                <label class="label is-small is-aligned">{{ unefichefrais.ETP.quantite * unefichefrais.ETP.idfraisforfait.montantfraisforfait }}</label>
                                                            </p>
                                                            <p class="control has-icons-left is-expanded">
                                                                <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.KM.idfraisforfait.libellefraisforfait }}</label>
                                                                <input class="input is-small" type="number" placeholder="{{ unefichefrais.KM.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.KM.quantite }}" name="qtKM" required="required" disabled>
                                                                <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                                <label class="label is-small is-aligned has-8px-margin-top">({{ unefichefrais.KM.quantite }} x {{ unefichefrais.idcv.facteurcv}}) + {{ unefichefrais.idcv.constantecv }}</label>
                                                                <label class="label is-small is-aligned">{{ unefichefrais.KM.quantite * unefichefrais.idcv.facteurcv + unefichefrais.idcv.constantecv }}</label>
                                                            </p>
                                                            <p class="control has-icons-left is-expanded">
                                                                <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.NUI.idfraisforfait.libellefraisforfait }}</label>
                                                                <input class="input is-small" type="number" placeholder="{{ unefichefrais.NUI.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.NUI.quantite }}" name="qtNUI" required="required" disabled>
                                                                <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                                <label class="label is-small is-aligned has-8px-margin-top">{{ unefichefrais.NUI.idfraisforfait.montantfraisforfait }}</label>
                                                                <label class="label is-small is-aligned">{{ unefichefrais.NUI.quantite * unefichefrais.NUI.idfraisforfait.montantfraisforfait }}</label>
                                                            </p>
                                                            <p class="control has-icons-left is-expanded">
                                                                <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.REP.idfraisforfait.libellefraisforfait }}</label>
                                                                <input class="input is-small" type="number" placeholder="{{ unefichefrais.REP.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.REP.quantite }}" name="qtREP" required="required" disabled>
                                                                <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                                <label class="label is-small is-aligned has-8px-margin-top">{{ unefichefrais.REP.idfraisforfait.montantfraisforfait }}</label>
                                                                <label class="label is-small is-aligned">{{ unefichefrais.REP.quantite * unefichefrais.REP.idfraisforfait.montantfraisforfait }}</label>
                                                            </p>
                                                            <p class="control">
                                                                <input class="is-hidden" type="text" value="{{unefichefrais.idfichefrais}}" name="idfichefrais">
                                                                <button id="buttonsaveap{{loop.index}}" class="button is-small is-success has-no-margin-bottom" type="submit" disabled>
                                                                    <SPAN>ENREGISTRER</SPAN>
                                                                    <span id="" class="icon is-on-left">
                                                                        <i class="fas fa-save"></i>
                                                                    </span>
                                                                </button>
                                                                <label class="label is-small is-aligned has-8px-margin-top">Montant</label>
                                                                <label class="label is-small is-aligned">Total</label>
                                                            </p>
                                                        </div>
                                                    </form>
                                                    <hr>
                                                    <form onsubmit="" class="has-text-left has-no-margin-bottom" action="" method="POST">
                                                        <div class="field has-addons has-no-margin-bottom">
                                                            <p id='inputdateap{{loop.index}}' class="control has-icons-left is-expanded">
                                                                <label class="label is-small is-aligned has-white-space-nowrap">Date</label>
                                                                {% if unefichefrais.lignesfraishorsforfait is defined %}
                                                                    {% for unelignefraishorsforfait in unefichefrais.lignesfraishorsforfait %}
                                                                        <input id="inputdatefhfap{{ loop.index }}" class="input is-small has-4px-margin-bottom has-border-radius-left" type="date" value="{{ unelignefraishorsforfait.date | date("Y-m-d")}}" name="dateFHF[]" required="required" disabled>
                                                                    {% endfor %}
                                                                {% else %}
                                                                    <input class="input is-small has-4px-margin-bottom has-border-radius-left" type="date" placeholder="Date" name="dateFHF[]" disabled>
                                                                {% endif %}
                                                                <span id="spandatefhfap{{ loop.index }}" class="icon is-aligned is-small is-left">
                                                                <i class="fas fa-edit"></i>
                                                            </span>

                                                            </p>
                                                            <p id='inputlibelleap{{loop.index}}' class="control has-icons-left is-expanded">
                                                                <label class="label is-small is-aligned has-white-space-nowrap">Libelle</label>
                                                                {% if unefichefrais.lignesfraishorsforfait is defined %}
                                                                    {% for unelignefraishorsforfait in unefichefrais.lignesfraishorsforfait %}
                                                                        <input id="inputlibellefhfap{{ loop.index }}" class="input is-small has-4px-margin-bottom" type="text" placeholder="Libelle" value="{{ unelignefraishorsforfait.libelle }}" name="libelleFHF[]" required="required" disabled>
                                                                    {% endfor %}
                                                                {% else %}
                                                                    <input class="input is-small has-4px-margin-bottom" type="text" placeholder="Libelle" name="libelleFHF[]" disabled>
                                                                {% endif %}
                                                                <span id="spanlibellefhfap{{ loop.index }}" class="icon is-aligned is-small is-left">
                                                                <i class="fas fa-edit"></i>
                                                            </span>

                                                            </p>
                                                            <p id="inputmontantap{{loop.index}}" class="control has-icons-left is-expanded">
                                                                <label class="label is-small is-aligned has-white-space-nowrap">Montant</label>
                                                                {% if unefichefrais.lignesfraishorsforfait is defined %}
                                                                    {% for unelignefraishorsforfait in unefichefrais.lignesfraishorsforfait %}
                                                                        <input id="inputmontantfhfap{{ loop.index }}" class="input is-small has-4px-margin-bottom has-right-button" pattern="^\d*(\.\d{0,2})?$" placeholder="Montant" value="{{ unelignefraishorsforfait.montant }}" name="montantFHF[]" required="required" disabled>
                                                                        <a id="buttondeletefhfac{{ loop.index }}" class="button buttondeletefhf is-small is-danger" disabled>
                                                                            <span>SUPPRIMER <i class="fas fa-trash-alt"></i></span>
                                                                        </a>
                                                                    {% endfor %}
                                                                {% else %}
                                                                    <input class="input is-small has-4px-margin-bottom" pattern="^\d*(\.\d{0,2})?$" placeholder="00.00" name="montantFHF[]" required="required" disabled>
                                                                {% endif %}
                                                                <span id="spanmontantfhfap{{ loop.index }}" class="icon is-aligned is-small is-left">
                                                                <i class="fas fa-edit"></i>
                                                            </span>

                                                            </p>
                                                            <p class="control">
                                                                <input class="is-hidden" type="text" value="{{unefichefrais.idfichefrais}}" name="idfichefrais" disabled>
                                                            <div class="button-div">
                                                                <button id="buttonsavefhfap{{loop.index}}" class="button is-small is-success is-full" type="submit" disabled>
                                                                    <span>ENREGISTRER</span>
                                                                    <span class="icon is-on-left">
                                                                    <i class="fas fa-save"></i>
                                                                </span>
                                                                </button>
                                                            </div>
                                                            </p>
                                                        </div>
                                                        <div class="field has-addons">
                                                            <p class="control has-icons-left is-expanded">
                                                                <label class="label is-small is-aligned has-white-space-nowrap has-2px-margin-top">
                                                                    Total
                                                                </label>
                                                            </p>
                                                            <p class="control has-icons-left is-expanded">
                                                                <label class="label is-small is-aligned has-white-space-nowrap has-2px-margin-top">
                                                                </label>
                                                            </p>
                                                            <p class="control has-icons-left is-expanded">
                                                                <a id='buttonaddap{{loop.index}}' class="button-add">
                                                                <span class="icon is-small span-add">
                                                                    <i class="fas fa-plus-circle"></i>
                                                                </span>
                                                                </a>
                                                                <label class="label is-small is-aligned has-white-space-nowrap has-2px-margin-top">
                                                                    {% if unefichefrais.montanttotalfraishorsforfait is defined %}
                                                                        {{ unefichefrais.montanttotalfraishorsforfait }} €
                                                                    {% else %}
                                                                        0 €
                                                                    {% endif %}
                                                                </label>
                                                            </p>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-14px-padding-top has-no-padding-bottom has-2px-padding-top has-6px-padding-top-on-mobile">
                                            <span class="icon is-small">
                                                <i id="arrowap{{loop.index}}" class="fas fa-chevron-down fa-lg grow cursor-pointer"></i>
                                            </span>
                                            <script>
                                                $(document).ready(function() {
                                                    $("#arrowap{{loop.index}},#addap{{ loop.index }},#consultap{{loop.index}}").click(function () {
                                                        if ($("#arrowap{{loop.index}}").hasClass('fa-chevron-down')) {

                                                            $("#arrowap{{loop.index}}").addClass('unique');
                                                            $('#boxap{{loop.index}}').addClass('unique');
                                                            $('#columnap{{loop.index}}').addClass('unique');

                                                            if($('i[id*="arrowap"]').not("unique").hasClass('fa-chevron-up')){

                                                                $('i[id*="arrowap"]').not("unique").fadeOut(150, function () {
                                                                    $('i[id*="arrowap"]').not("unique").removeClass('fa-chevron-up');
                                                                    $('div[id*="boxap"]').not("unique").addClass('is-transparent').removeClass('is-asked-to-be-modified-past').removeClass('is-asked-to-be-modified-current').height(280);

                                                                    $('div[id*="columnap"]').not(".unique").fadeOut(150, function () {
                                                                        $('div[id*="columnap"]').not(".unique").addClass('is-hidden');

                                                                        $('i[id*="arrowap"]').not(".unique").fadeIn(150, function () {
                                                                            $('i[id*="arrowap"]').not(".unique").addClass('fa-chevron-down');
                                                                        });
                                                                    });
                                                                });
                                                            }

                                                            $('#arrowap{{loop.index}}').fadeOut(150, function () {
                                                                $('#arrowap{{loop.index}}').removeClass('fa-chevron-down');

                                                                $('#columnap{{loop.index}}').fadeIn(150, function (){
                                                                    $('#columnap{{loop.index}}').removeClass('is-hidden');

                                                                    $('#arrowap{{loop.index}}').fadeIn(150, function () {
                                                                        $('#arrowap{{loop.index}}').addClass('fa-chevron-up');
                                                                        var newHeight = 340+$("#columnap{{loop.index}}").height();
                                                                        $('#boxap{{loop.index}}').addClass('is-asked-to-be-modified-past').height(newHeight).removeClass('is-transparent');

                                                                        $("#arrowap{{loop.index}}").removeClass('unique');
                                                                        $('#boxap{{loop.index}}').removeClass('unique');
                                                                        $('#columnap{{loop.index}}').removeClass('unique');
                                                                    });
                                                                });
                                                            });
                                                        } else {

                                                            $('#arrowap{{loop.index}}').fadeOut(150, function () {
                                                                $('#arrowap{{loop.index}}').removeClass('fa-chevron-up');
                                                                $('#boxap{{loop.index}}').addClass('is-transparent').removeClass('is-asked-to-be-modified-past').height(280);

                                                                $('#columnap{{loop.index}}').fadeOut(150, function () {
                                                                    $('#columnap{{loop.index}}').addClass('is-hidden');

                                                                    $('#arrowap{{loop.index}}').fadeIn(150, function () {
                                                                        $('#arrowap{{loop.index}}').addClass('fa-chevron-down');
                                                                    });
                                                                });
                                                            });
                                                        }
                                                    });
                                                });
                                            </script>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
